<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Keuangan</title>
  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet" href="css/modal.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/config.js"></script>
  <script src="js/sheets-db.js"></script>
  <script src="js/auth-client.js"></script>
</head>
<body>

<div class="page">

  <!-- HEADER -->
  <header class="header">
    <div class="brand">
      <div class="logo">ðŸ’¼</div>
      <div>
        <strong>Dashboard Keuangan</strong>
        <div class="muted">Kelola keuangan Anda dengan mudah</div>
      </div>
    </div>
    <button class="btn logout" onclick="doLogout()">Logout</button>
  </header>

  <!-- HERO / USER INFO -->
  <section class="hero">
    <div class="hero-left clickable" onclick="openProfileModal()">
      <div class="avatar">ðŸ‘¤</div>
      <div class="user-info">
        <strong id="username">User</strong>
        <div class="muted" id="userEmail">email@example.com</div>
      </div>
    </div>
    <div class="hero-right">
      <div class="muted">Saldo Tersedia</div>
      <h2 class="balance-amount"><span>Rp</span> <span id="balance">0</span></h2>
    </div>
  </section>

  <!-- FILTER PERIODE -->
  <section class="filter-section">
    <span class="filter-label">Filter Periode</span>
    <div class="filter-buttons">
      <button class="filter-btn" data-filter="today" onclick="setFilter('today')">Hari Ini</button>
      <button class="filter-btn" data-filter="week" onclick="setFilter('week')">7 Hari Terakhir</button>
      <button class="filter-btn active" data-filter="month" onclick="setFilter('month')">Bulan Ini</button>
    </div>
    <div class="report-buttons">
      <button class="btn secondary" onclick="openMonthlyReportModal()">ðŸ“Š Rekap Bulanan</button>
      <button class="btn secondary" onclick="openDebtReportModal()">ðŸ“‹ Rekap Utang/Piutang</button>
    </div>
  </section>

  <!-- RINGKASAN -->
  <section class="summary-section">
    <h3 class="section-title" id="summaryTitle">Ringkasan Bulan Ini</h3>
    <div class="summary">
      <div class="chart-wrapper">
        <canvas id="pieChart"></canvas>
      </div>
      <div class="summary-right">
        <div class="summary-card green">
          <div class="summary-icon">ðŸ“ˆ</div>
          <div class="summary-info">
            <span class="summary-label">Uang Masuk</span>
            <strong class="summary-value"><span>Rp</span> <span id="income">0</span></strong>
          </div>
          <span class="summary-percent" id="incomePercent">0%</span>
        </div>

        <div class="summary-card red">
          <div class="summary-icon">ðŸ“‰</div>
          <div class="summary-info">
            <span class="summary-label">Uang Keluar</span>
            <strong class="summary-value red-text"><span>Rp</span> <span id="expense">0</span></strong>
          </div>
          <span class="summary-percent" id="expensePercent">0%</span>
        </div>

        <div class="summary-card blue">
          <div class="summary-info">
            <span class="summary-label">Saldo Bersih</span>
            <strong class="summary-value"><span>Rp</span> <span id="net">0</span></strong>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <section class="main">

    <!-- TRANSAKSI -->
    <div class="card">
      <div class="card-header">
        <strong>Transaksi</strong>
        <button class="btn primary" onclick="openAddTransaction()">+ Tambah</button>
      </div>
      
      <!-- Summary Boxes -->
      <div class="card-summary">
        <div class="mini-card green">
          <div class="mini-icon">ðŸ“ˆ</div>
          <span class="mini-label">Uang Masuk</span>
          <strong class="mini-value green-text"><span>Rp</span> <span id="trxIncome">0</span></strong>
        </div>
        <div class="mini-card red">
          <div class="mini-icon">ðŸ“‰</div>
          <span class="mini-label">Uang Keluar</span>
          <strong class="mini-value red-text"><span>Rp</span> <span id="trxExpense">0</span></strong>
        </div>
      </div>

      <!-- Scrollable Transaction List -->
      <div class="scroll-container" id="transactionScroll">
        <ul class="trx-list" id="transactionList"></ul>
      </div>
    </div>

    <!-- UTANG & PIUTANG -->
    <div class="card">
      <div class="card-header">
        <strong>Utang & Piutang</strong>
        <button class="btn primary" onclick="openAddDebt()">+ Tambah</button>
      </div>

      <!-- Summary Boxes -->
      <div class="card-summary">
        <div class="mini-card red">
          <div class="mini-icon">ðŸ“‹</div>
          <span class="mini-label">Total Utang</span>
          <strong class="mini-value red-text"><span>Rp</span> <span id="totalDebt">0</span></strong>
        </div>
        <div class="mini-card green">
          <div class="mini-icon">ðŸ“‹</div>
          <span class="mini-label">Total Piutang</span>
          <strong class="mini-value green-text"><span>Rp</span> <span id="totalReceivable">0</span></strong>
        </div>
      </div>

      <!-- Scrollable Debt List -->
      <div class="scroll-container" id="debtScroll">
        <div id="debtList"></div>
      </div>
    </div>

  </section>
</div>

<!-- TRANSACTION MODAL -->
<div class="modal hidden" id="transactionModal">
  <div class="modal-box">
    <strong id="modalTitle">Tambah Transaksi</strong>

    <label>Tipe</label>
    <select id="trxType">
      <option value="income">Uang Masuk</option>
      <option value="expense">Uang Keluar</option>
    </select>

    <label>Jumlah</label>
    <input id="trxAmount" type="number" placeholder="Jumlah" />
    
    <label>Deskripsi</label>
    <input id="trxNote" placeholder="Deskripsi" />
    
    <label>Tanggal</label>
    <input id="trxDate" type="date" />

    <div class="modal-actions">
      <button class="btn" onclick="closeModal('transactionModal')">Batal</button>
      <button class="btn primary" onclick="saveTransaction()">Simpan</button>
    </div>
  </div>
</div>

<!-- DEBT MODAL -->
<div class="modal hidden" id="debtModal">
  <div class="modal-box">
    <strong id="debtModalTitle">Tambah Utang / Piutang</strong>

    <label>Tipe</label>
    <select id="debtType">
      <option value="debt">Utang</option>
      <option value="receivable">Piutang</option>
    </select>

    <label>Nama</label>
    <input id="debtName" placeholder="Nama orang/instansi" />
    
    <label>Jumlah</label>
    <input id="debtAmount" type="number" placeholder="Jumlah" />
    
    <label>Jatuh Tempo</label>
    <input id="debtDueDate" type="date" />

    <div class="modal-actions">
      <button class="btn" onclick="closeModal('debtModal')">Batal</button>
      <button class="btn primary" onclick="saveDebt()">Simpan</button>
    </div>
  </div>
</div>

<!-- PROFILE MODAL -->
<div class="modal hidden" id="profileModal">
  <div class="modal-box">
    <strong>Edit Profil</strong>

    <label>Nama</label>
    <input id="profileName" placeholder="Nama lengkap" />
    
    <label>Email (tidak bisa diubah)</label>
    <input id="profileEmail" type="email" disabled />

    <div class="modal-actions">
      <button class="btn" onclick="closeModal('profileModal')">Batal</button>
      <button class="btn primary" onclick="saveProfile()">Simpan</button>
    </div>
  </div>
</div>

<!-- MONTHLY REPORT MODAL -->
<div class="modal hidden" id="monthlyReportModal">
  <div class="modal-box modal-large">
    <strong>ðŸ“Š Rekap Bulanan</strong>
    
    <div class="report-filter">
      <label>Pilih Bulan</label>
      <input id="reportMonth" type="month" />
      <button class="btn primary" onclick="generateMonthlyReport()">Lihat Rekap</button>
    </div>
    
    <div id="monthlyReportPreview" class="report-preview hidden">
      <!-- Preview will be rendered here -->
    </div>
    
    <div id="monthlyReportActions" class="modal-actions hidden">
      <button class="btn" onclick="closeModal('monthlyReportModal')">Tutup</button>
      <button class="btn primary" onclick="sendMonthlyReportEmail()">ðŸ“§ Kirim ke Email</button>
    </div>
    
    <div id="monthlyReportClose" class="modal-actions">
      <button class="btn" onclick="closeModal('monthlyReportModal')">Tutup</button>
    </div>
  </div>
</div>

<!-- DEBT REPORT MODAL -->
<div class="modal hidden" id="debtReportModal">
  <div class="modal-box modal-large">
    <strong>ðŸ“‹ Rekap Utang/Piutang per Nama</strong>
    
    <div class="report-filter">
      <label>Pilih Nama</label>
      <select id="debtReportName">
        <option value="">-- Pilih Nama --</option>
      </select>
      <button class="btn primary" onclick="generateDebtReport()">Lihat Rekap</button>
    </div>
    
    <div id="debtReportPreview" class="report-preview hidden">
      <!-- Preview will be rendered here -->
    </div>
    
    <div id="debtReportActions" class="modal-actions hidden">
      <button class="btn" onclick="closeModal('debtReportModal')">Tutup</button>
      <button class="btn primary" onclick="sendDebtReportEmail()">ðŸ“§ Kirim ke Email</button>
    </div>
    
    <div id="debtReportClose" class="modal-actions">
      <button class="btn" onclick="closeModal('debtReportModal')">Tutup</button>
    </div>
  </div>
</div>

<script src="js/dashboard-static.js"></script>

</body>
</html>
